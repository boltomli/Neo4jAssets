@{
    ViewBag.Title = "Home Page";
}

@*<div class="jumbotron">
    <h1>ASP.NET</h1>
    <p class="lead">ASP.NET is a free web framework for building great Web sites and Web applications using HTML, CSS and JavaScript.</p>
    <p><a href="http://asp.net" class="btn btn-primary btn-lg">Learn more &raquo;</a></p>
</div>*@

<div class="row">
    <div class="col-md-4">
        <form role="search" class="navbar-form" id="search">
            <div class="form-group">
                <input type="text" value="@User.Identity.Name.Split('\\')[1]" placeholder="Search by owner" class="form-control" name="search" />
            </div>
            <button class="btn btn-default" type="submit">Search</button>
        </form>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">Results</div>
            <table id="results" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Serial Number</th>
                        <th>Asset Tag</th>
                        <th>Model</th>
                        @*<th>Type</th>*@
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    @*<div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading" id="title">Details</div>
            <div class="row">
                <div class="col-sm-4 col-md-4">
                    <img src="" class="well" id="poster" />
                </div>
            </div>
        </div>
    </div>*@
    <script type="text/javascript" src="~/Scripts/jquery-2.1.4.min.js"></script>
    @*<script type="text/javascript" src="~/Scripts/d3/d3.min.js"></script>*@
    <script type="text/javascript">
        $(function () {
            function showDevice(sn) {
                $.get("/sn/" + encodeURIComponent(sn),
                        function (data) {
                            if (!data) return;
                            //$("#title").text(data.title);
                            //$("#poster").attr("src", "http://neo4j-contrib.github.io/developer-resources/language-guides/assets/posters/" + encodeURIComponent(data.title) + ".jpg");
                            //var $list = $("#crew").empty();
                            //data.cast.forEach(function (cast) {
                            //    $list.append($("<li>" + cast.name + " " + cast.job + (cast.job == "acted" ? " as " + cast.role : "") + "</li>"));
                            //});
                        }, "json");
                return false;
            }
            function search() {
                var query = $("#search").find("input[name=search]").val();
                $.get("/search?q=" + encodeURIComponent(query),
                        function (data) {
                            var t = $("table#results tbody").empty();
                            if (!data || data.length == 0) return;
                            data.forEach(function (row) {
                                var device = row.device;
                                $("<tr><td class='device'>" + device.SN + "</td><td>" + device.AssetTag + "</td><td>" + device.Model + "</td></tr>").appendTo(t)
                                        .click(function () { showdevice($(this).find("td.device").text()); })
                            });
                            showDevice(data[0].device.SN);
                        }, "json");
                return false;
            }

            $("#search").submit(search);
            search();
        })
    </script>
</div>