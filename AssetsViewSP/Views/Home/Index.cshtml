@{
    ViewBag.Title = "Home Page";
}

<div class="row">
    <div class="col-md-4">
        <form role="search" class="navbar-form" id="search">
            <div class="form-group">
                <input type="text" value="@User.Identity.Name.Split('\\')[1]" placeholder="Search by owner" class="form-control" name="search" />
            </div>
            <button class="btn btn-default" type="submit">Search</button>
        </form>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">Results</div>
            <table id="results" class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Serial Number</th>
                        <th>Asset Tag</th>
                        <th>Model</th>
                        @*<th>Type</th>*@
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    @*<div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading" id="title">Details</div>
            <div class="row">
                <div class="col-sm-4 col-md-4">
                    <img src="" class="well" id="poster" />
                </div>
            </div>
        </div>
    </div>*@
    <script type="text/javascript" src="~/Scripts/jquery-2.1.4.min.js"></script>
    @*<script type="text/javascript" src="~/Scripts/d3/d3.min.js"></script>*@
    <script type="text/javascript">
        $(function () {
            function showDevice(sn) {
                $.get(window.location.href + "/device/" + encodeURIComponent(sn),
                        function (data) {
                            if (!data) return;
                            //$("#sn").text(data.SN);
                            //$("#poster").attr("src", "//img/posters/" + encodeURIComponent(data.Type) + ".jpg");
                        }, "json");
                return false;
            }
            function search() {
                var query = $("#search").find("input[name=search]").val();
                $.get(window.location.href + "/search?q=" + encodeURIComponent(query),
                        function (data) {
                            var t = $("table#results tbody").empty();
                            if (!data || data.length == 0) return;
                            data.forEach(function (row) {
                                var device = row.device;
                                $("<tr><td class='device'>" + device.sn + "</td><td>" + device.assetTag + "</td><td>" + device.model + "</td></tr>").appendTo(t)
                                        .click(function () { showDevice($(this).find("td.device").text()); })
                            });
                            showDevice(data[0].device.sn);
                        }, "json");
                return false;
            }

            $("#search").submit(search);
            search();
        })
    </script>
</div>